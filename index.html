<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>GÃ¼nlÃ¼k MaÃ§ Ä°statistikleri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 16px;
  background: #f6f7f9;
}

h1 {
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 16px;
}

/* TARÄ°H */
.date-filters {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 14px;
}
.date-pill {
  padding: 6px 12px;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 999px;
  cursor: pointer;
  font-size: 13px;
}
.date-pill.active {
  background: #16a34a;
  color: #fff;
  border-color: #16a34a;
}

/* SPOR */
.sport-filters {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
}
.sport-pill {
  cursor: pointer;
  font-size: 24px;
  opacity: .4;
  transition: .15s;
}
.sport-pill.active {
  opacity: 1;
  transform: scale(1.1);
}

/* KATEGORÄ° BAÅLIÄI */
.collapsible {
  padding: 12px;
  background: #fff;
  margin-top: 16px;
  border-radius: 12px;
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}
.collapsible span.chevron {
  font-size: 16px;
  transform: rotate(0deg);
  transition: transform 0.2s;
}
.collapsible.closed span.chevron {
  transform: rotate(-90deg);
}

.content {
  margin-top: 6px;
}
.content.closed {
  display: none;
}

/* KARTLAR */
.section {
  background: #fff;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.stat-item {
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}
.stat-item:last-child {
  border-bottom: none;
}
.teams {
  font-weight: 600;
  display: flex;
  gap: 6px;
}
.detail {
  color: #666;
  font-size: 13px;
  margin: 4px 0;
}
.highlight {
  color: #16a34a;
  font-weight: 700;
  margin-bottom: 6px;
}
.btn {
  background: #16a34a;
  color: white;
  padding: 8px;
  border-radius: 8px;
  width: 100%;
  border: none;
  cursor: pointer;
}

/* DURUM MESAJLARI */
.status {
  text-align: center;
  font-size: 13px;
  color: #666;
  margin-top: 8px;
}
</style>
</head>

<body>

<h1>GÃ¼nlÃ¼k MaÃ§ Ä°statistikleri</h1>

<!-- TARÄ°H -->
<div class="date-filters" id="dateFilters"></div>

<!-- SPOR -->
<div class="sport-filters">
  <span class="sport-pill active" data-sport="futbol">âš½ï¸</span>
  <span class="sport-pill" data-sport="basketbol">ğŸ€</span>
  <span class="sport-pill" data-sport="tenis">ğŸ¾</span>
</div>

<div id="status" class="status"></div>
<div id="categories"></div>

<script>
/* ============================
   TARÄ°H PÄ°LL'LERÄ°NÄ° OLUÅTUR
============================ */
const dateFiltersEl = document.getElementById("dateFilters");
const statusEl = document.getElementById("status");
const categoriesEl = document.getElementById("categories");

function formatDateLabel(offset) {
  const d = new Date();
  d.setDate(d.getDate() + offset);

  if (offset === 0) return "BugÃ¼n";

  const aylar = [
    "Ocak","Åubat","Mart","Nisan","MayÄ±s","Haziran",
    "Temmuz","AÄŸustos","EylÃ¼l","Ekim","KasÄ±m","AralÄ±k"
  ];
  const gun = d.getDate();
  const ay = aylar[d.getMonth()];
  return `${gun} ${ay}`;
}

function initDatePills() {
  for (let offset = 0; offset <= 2; offset++) {
    const pill = document.createElement("div");
    pill.className = "date-pill" + (offset === 0 ? " active" : "");
    pill.dataset.offset = offset;
    pill.textContent = formatDateLabel(offset);
    dateFiltersEl.appendChild(pill);
  }
}

/* ============================
   GLOBAL DURUM
============================ */
let currentSport = "futbol";  // futbol / basketbol / tenis
let currentDayOffset = 0;     // 0 = bugÃ¼n, 1 = yarÄ±n, 2 = Ã¶bÃ¼r gÃ¼n

/* ============================
   BACKEND'DEN VERÄ° Ã‡EK
============================ */
async function loadStats() {
  statusEl.textContent = "YÃ¼kleniyor...";
  categoriesEl.innerHTML = "";

  try {
    const url = `http://localhost:4000/api/stats?sport=${encodeURIComponent(currentSport)}&day=${currentDayOffset}`;
    const res = await fetch(url);
    if (!res.ok) {
      throw new Error("Sunucudan geÃ§erli yanÄ±t alÄ±namadÄ±");
    }
    const data = await res.json();

    // Futbol: fixtures dÃ¶nÃ¼yor
    if (data.sport === "futbol" && Array.isArray(data.fixtures)) {
      const items = data.fixtures.map(f => {
        const league = f.league?.name || "Lig";
        const country = f.league?.country || "";
        const home = f.teams?.home?.name || "Ev Sahibi";
        const away = f.teams?.away?.name || "Deplasman";

        return {
          flag: countryToFlag(country),
          teams: `${home} vs ${away}`,
          detail: `${league} maÃ§Ä±nda iki takÄ±m da Ã¶nemli bir karÅŸÄ±laÅŸmaya Ã§Ä±kÄ±yor.`,
          highlight: "MaÃ§Ä± Ä°ncele"
        };
      });

      const statsObj = {
        "âš½ï¸ BugÃ¼nÃ¼n MaÃ§larÄ±": items
      };

      renderCategories(statsObj);
    }
    // Basketbol / Tenis: stats objesi dÃ¶nÃ¼yor
    else if (data.stats && typeof data.stats === "object") {
      renderCategories(data.stats);
    } else {
      categoriesEl.innerHTML = "";
      statusEl.textContent = "Bu gÃ¼n iÃ§in gÃ¶sterilecek istatistik bulunamadÄ±.";
      return;
    }

    statusEl.textContent = "";
  } catch (err) {
    console.error("YÃ¼kleme hatasÄ±:", err);
    statusEl.textContent = "Veriler yÃ¼klenirken bir hata oluÅŸtu.";
  }
}

/* ============================
   KATEGORÄ°LERÄ° RENDER ET
============================ */
function renderCategories(statsObj) {
  categoriesEl.innerHTML = "";

  const entries = Object.entries(statsObj);

  if (!entries.length) {
    statusEl.textContent = "Bu gÃ¼n iÃ§in gÃ¶sterilecek istatistik bulunamadÄ±.";
    return;
  }

  entries.forEach(([category, items]) => {
    if (!Array.isArray(items) || items.length === 0) return;

    const block = document.createElement("div");

    block.innerHTML = `
      <div class="collapsible">
        <div>${category}</div>
        <span class="chevron">âŒ„</span>
      </div>
      <div class="content">
        <div class="section">
          ${items.map(item => `
            <div class="stat-item">
              <div class="teams"><span>${item.flag || ""}</span> ${item.teams || ""}</div>
              <div class="detail">${item.detail || ""}</div>
              <div class="highlight">${item.highlight || ""}</div>
              <button class="btn">Bahis Yap</button>
            </div>
          `).join("")}
        </div>
      </div>
    `;

    categoriesEl.appendChild(block);
  });

  // Collapse olaylarÄ±
  document.querySelectorAll(".collapsible").forEach(c => {
    const content = c.nextElementSibling;
    const chevron = c.querySelector(".chevron");
    c.onclick = () => {
      content.classList.toggle("closed");
      c.classList.toggle("closed");
    };
  });
}

/* ============================
   ÃœLKE ADINDAN BAYRAK EMOJÄ°SÄ°
============================ */
function countryToFlag(country = "") {
  const map = {
    Turkey: "ğŸ‡¹ğŸ‡·",
    TÃ¼rkiye: "ğŸ‡¹ğŸ‡·",
    England: "ğŸ´",
    "United Kingdom": "ğŸ´",
    Spain: "ğŸ‡ªğŸ‡¸",
    Germany: "ğŸ‡©ğŸ‡ª",
    Italy: "ğŸ‡®ğŸ‡¹",
    France: "ğŸ‡«ğŸ‡·",
    Portugal: "ğŸ‡µğŸ‡¹",
    Netherlands: "ğŸ‡³ğŸ‡±",
    USA: "ğŸ‡ºğŸ‡¸",
    Brazil: "ğŸ‡§ğŸ‡·",
    Argentina: "ğŸ‡¦ğŸ‡·"
  };
  return map[country] || "ğŸ³ï¸";
}

/* ============================
   EVENT BINDING
============================ */
function bindEvents() {
  // Tarih tÄ±klama
  document.querySelectorAll(".date-pill").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".date-pill").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentDayOffset = parseInt(btn.dataset.offset, 10) || 0;
      loadStats();
    };
  });

  // Spor tÄ±klama
  document.querySelectorAll(".sport-pill").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".sport-pill").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentSport = btn.dataset.sport;
      loadStats();
    };
  });
}

/* ============================
   SAYFA YÃœKLENÄ°NCE
============================ */
initDatePills();
bindEvents();
loadStats();
</script>
</body>
</html>
