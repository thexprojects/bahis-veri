<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>G√ºnl√ºk Ma√ß ƒ∞statistikleri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 16px;
  background: #f6f7f9;
}

h1 {
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 16px;
}

/* TARƒ∞H */
.date-filters {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 14px;
}
.date-pill {
  padding: 6px 12px;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 999px;
  cursor: pointer;
  font-size: 13px;
}
.date-pill.active {
  background: #16a34a;
  color: #fff;
  border-color: #16a34a;
}

/* SPOR */
.sport-filters {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
}
.sport-pill {
  cursor: pointer;
  font-size: 24px;
  opacity: .4;
  transition: .15s;
}
.sport-pill.active {
  opacity: 1;
  transform: scale(1.1);
}

/* KATEGORƒ∞ BA≈ûLIƒûI */
.collapsible {
  padding: 12px;
  background: #fff;
  margin-top: 16px;
  border-radius: 12px;
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}
.collapsible span.chevron {
  font-size: 16px;
  transform: rotate(0deg);
  transition: transform 0.2s;
}
.collapsible.closed span.chevron {
  transform: rotate(-90deg);
}

.content {
  margin-top: 6px;
}
.content.closed {
  display: none;
}

/* KARTLAR */
.section {
  background: #fff;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.stat-item {
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}
.stat-item:last-child {
  border-bottom: none;
}
.teams {
  font-weight: 600;
  display: flex;
  gap: 6px;
}
.detail {
  color: #666;
  font-size: 13px;
  margin: 4px 0;
}
.highlight {
  color: #16a34a;
  font-weight: 700;
  margin-bottom: 6px;
}
.btn {
  background: #16a34a;
  color: white;
  padding: 8px;
  border-radius: 8px;
  width: 100%;
  border: none;
  cursor: pointer;
}

/* DURUM MESAJLARI */
.status {
  text-align: center;
  font-size: 13px;
  color: #666;
  margin-top: 8px;
}
</style>
</head>

<body>

<h1>G√ºnl√ºk Ma√ß ƒ∞statistikleri</h1>

<!-- TARƒ∞H -->
<div class="date-filters" id="dateFilters"></div>

<!-- SPOR -->
<div class="sport-filters">
  <span class="sport-pill active" data-sport="futbol">‚öΩÔ∏è</span>
  <span class="sport-pill" data-sport="basketbol">üèÄ</span>
  <span class="sport-pill" data-sport="tenis">üéæ</span>
</div>

<div id="status" class="status"></div>
<div id="categories"></div>

<script>
/* ============================
   BACKEND URL (Render)
============================ */
const API_BASE = "https://sports-stats-api-fftx.onrender.com";

/* ============================
   TARƒ∞H Pƒ∞LL'LERƒ∞Nƒ∞ OLU≈ûTUR
============================ */
const dateFiltersEl = document.getElementById("dateFilters");
const statusEl = document.getElementById("status");
const categoriesEl = document.getElementById("categories");

function formatDateLabel(offset) {
  const d = new Date();
  d.setDate(d.getDate() + offset);

  if (offset === 0) return "Bug√ºn";

  const aylar = [
    "Ocak","≈ûubat","Mart","Nisan","Mayƒ±s","Haziran",
    "Temmuz","Aƒüustos","Eyl√ºl","Ekim","Kasƒ±m","Aralƒ±k"
  ];
  return `${d.getDate()} ${aylar[d.getMonth()]}`;
}

function initDatePills() {
  for (let offset = 0; offset <= 2; offset++) {
    const pill = document.createElement("div");
    pill.className = "date-pill" + (offset === 0 ? " active" : "");
    pill.dataset.offset = offset;
    pill.textContent = formatDateLabel(offset);
    dateFiltersEl.appendChild(pill);
  }
}

/* ============================
   GLOBAL DURUM
============================ */
let currentSport = "futbol";
let currentDayOffset = 0;

/* ============================
   BACKEND'DEN VERƒ∞ √áEK
============================ */
async function loadStats() {
  statusEl.textContent = "Y√ºkleniyor...";
  categoriesEl.innerHTML = "";

  try {
    const url = `${API_BASE}/api/stats?sport=${encodeURIComponent(currentSport)}&day=${currentDayOffset}`;
    
    const res = await fetch(url);

    if (!res.ok) throw new Error("Sunucudan ge√ßerli yanƒ±t alƒ±namadƒ±");

    const data = await res.json();

    // Futbol API (fixtures formatƒ±)
    if (data.sport === "futbol" && Array.isArray(data.matches)) {
      const items = data.matches.map(f => {
        const league = f.league?.name || "Lig";
        const country = f.league?.country || "";
        const home = f.teams?.home?.name || "Ev Sahibi";
        const away = f.teams?.away?.name || "Deplasman";

        return {
          flag: countryToFlag(country),
          teams: `${home} vs ${away}`,
          detail: `${league} ma√ßƒ±nda √∂nemli bir kar≈üƒ±la≈üma oynanacak.`,
          highlight: "Ma√ßƒ± ƒ∞ncele"
        };
      });

      renderCategories({ "‚öΩÔ∏è Bug√ºn√ºn Ma√ßlarƒ±": items });
    }

    // Basketbol & Tenis (statik format)
    else if (data.stats) {
      renderCategories(data.stats);
    }

    else {
      statusEl.textContent = "Bu g√ºn i√ßin g√∂sterilecek istatistik yok.";
      return;
    }

    statusEl.textContent = "";
  } catch (err) {
    console.error("Y√ºkleme hatasƒ±:", err);
    statusEl.textContent = "Veriler y√ºklenirken bir hata olu≈ütu.";
  }
}

/* ============================
   KATEGORƒ∞LERƒ∞ RENDER ET
============================ */
function renderCategories(statsObj) {
  categoriesEl.innerHTML = "";
  const entries = Object.entries(statsObj);

  if (!entries.length) {
    statusEl.textContent = "G√∂sterilecek veri bulunamadƒ±.";
    return;
  }

  entries.forEach(([category, items]) => {
    const block = document.createElement("div");

    block.innerHTML = `
      <div class="collapsible">
        <div>${category}</div>
        <span class="chevron">‚åÑ</span>
      </div>
      <div class="content">
        <div class="section">
          ${items.map(item => `
            <div class="stat-item">
              <div class="teams"><span>${item.flag || ""}</span> ${item.teams}</div>
              <div class="detail">${item.detail}</div>
              <div class="highlight">${item.highlight}</div>
              <button class="btn">Bahis Yap</button>
            </div>
          `).join("")}
        </div>
      </div>
    `;

    categoriesEl.appendChild(block);
  });

  document.querySelectorAll(".collapsible").forEach(c => {
    const content = c.nextElementSibling;
    c.onclick = () => {
      content.classList.toggle("closed");
      c.classList.toggle("closed");
    };
  });
}

/* ============================
   BAYRAK EMOJƒ∞
============================ */
function countryToFlag(country = "") {
  const map = {
    Turkey: "üáπüá∑", T√ºrkiye: "üáπüá∑",
    England: "üè¥", "United Kingdom": "üè¥",
    Spain: "üá™üá∏", Germany: "üá©üá™", Italy: "üáÆüáπ",
    France: "üá´üá∑", Portugal: "üáµüáπ", Netherlands: "üá≥üá±",
    USA: "üá∫üá∏", Brazil: "üáßüá∑", Argentina: "üá¶üá∑"
  };
  return map[country] || "üè≥Ô∏è";
}

/* ============================
   EVENT BINDINGS
============================ */
function bindEvents() {
  document.querySelectorAll(".date-pill").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".date-pill").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentDayOffset = parseInt(btn.dataset.offset);
      loadStats();
    };
  });

  document.querySelectorAll(".sport-pill").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".sport-pill").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentSport = btn.dataset.sport;
      loadStats();
    };
  });
}

/* ============================
   SAYFA BA≈ûLANGICI
============================ */
initDatePills();
bindEvents();
loadStats();
</script>

</body>
</html>
